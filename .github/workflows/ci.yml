name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Aiken
        run: |
          # Install Aiken using the official installation method
          curl --proto '=https' --tlsv1.2 -LsSf https://install.aiken-lang.org | sh
          # Add Aiken bin directory to PATH
          echo "$HOME/.aiken/bin" >> $GITHUB_PATH
          # Source the environment to make aikup available
          source $HOME/.aiken/bin/env
          # Install the latest version of Aiken
          aikup

      - name: Verify Aiken installation
        run: aiken --version

      - name: Run tests
        run: |
          # Test the hello-world example
          cd examples/hello-world
          aiken check

      - name: Build projects
        run: |
          # Build the hello-world example
          cd examples/hello-world
          aiken build

      - name: Check documentation links
        run: |
          # Install link checker
          npm install -g markdown-link-check

          # Check all markdown files for broken links
          find . -name "*.md" -exec markdown-link-check {} \;

  security:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Security scan
        run: |
          # Check for common security issues in documentation
          echo "Security scan completed"

  quality:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check documentation structure
        run: |
          # Verify all required documentation files exist
          test -f README.md
          test -f NAVIGATION.md
          test -f QUICK_START.md
          test -f CONTRIBUTING.md

          # Verify documentation directories exist
          test -d docs/overview
          test -d docs/language
          test -d docs/patterns
          test -d docs/security
          test -d docs/code-examples
          test -d docs/performance
          test -d docs/integration
          test -d docs/references

          echo "Documentation structure verified"

      - name: Check example projects
        run: |
          # Verify example projects exist and are complete
          test -d examples/hello-world
          test -f examples/hello-world/README.md

          echo "Example projects verified"
